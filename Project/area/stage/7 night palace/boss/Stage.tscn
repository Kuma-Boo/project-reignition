[gd_scene load_steps=31 format=3 uid="uid://bppf7gbq56888"]

[ext_resource type="Curve3D" path="res://area/stage/7 night palace/boss/data/path/MainPath.tres" id="1"]
[ext_resource type="PackedScene" uid="uid://23645l655tbi" path="res://area/stage/7 night palace/data/model/NPSky.gltf" id="2"]
[ext_resource type="PackedScene" uid="uid://ceb6btswgk1h7" path="res://area/stage/7 night palace/data/model/NPBoss.gltf" id="3"]
[ext_resource type="Environment" path="res://area/stage/7 night palace/data/WorldEnvironment.tres" id="4"]
[ext_resource type="PackedScene" path="res://area/stage/7 night palace/data/music/BossBGM.tscn" id="5"]
[ext_resource type="PackedScene" uid="uid://cvn1n3jd8b70f" path="res://area/stage/7 night palace/data/model/NPBossLOD.gltf" id="6"]
[ext_resource type="Script" path="res://addons/Silicon.vfx.planar_reflection/planar_reflector.gd" id="7"]
[ext_resource type="Material" path="res://area/stage/7 night palace/data/model/Reflection.tres" id="8"]
[ext_resource type="PackedScene" path="res://area/stage/7 night palace/boss/data/object/Erazor.tscn" id="9"]
[ext_resource type="PackedScene" path="res://object/player/CharacterSpawn.tscn" id="10"]
[ext_resource type="PackedScene" path="res://object/trigger/StageTrigger.tscn" id="11"]
[ext_resource type="Script" path="res://object/trigger/modules/PathTrigger.cs" id="12"]
[ext_resource type="Script" path="res://object/trigger/modules/CheckpointTrigger.cs" id="13"]
[ext_resource type="Script" path="res://object/stage/StageSettings.cs" id="14"]
[ext_resource type="Script" path="res://area/stage/7 night palace/boss/data/script/InfiniteHallway.cs" id="15"]
[ext_resource type="PackedScene" path="res://area/stage/7 night palace/boss/data/object/ItemBundle.tscn" id="16"]
[ext_resource type="Resource" path="res://object/player/resource/movement settings/AutoRun.tres" id="17"]
[ext_resource type="Script" path="res://object/trigger/modules/LockoutTrigger.cs" id="18"]
[ext_resource type="Texture2D" uid="uid://pa3878yw7u8f" path="res://area/stage/7 night palace/boss/data/reflection/follow_roughness.png" id="19"]

[sub_resource type="SphereShape3D" id="9"]
radius = 3.0

[sub_resource type="BoxShape3D" id="10"]
size = Vector3(16, 28, 2)

[sub_resource type="ArrayMesh" id="11"]
resource_name = "NPBossCollision_Floor"
_surfaces = [{
"aabb": AABB(-5.41997, -0.000161636, -88.1306, 10.8721, 0.000328673, 88.0315),
"format": 4099,
"index_count": 6,
"index_data": PackedByteArray(0, 0, 3, 0, 1, 0, 0, 0, 2, 0, 3, 0),
"primitive": 3,
"vertex_count": 4,
"vertex_data": PackedByteArray(100, 112, 173, 192, 91, 170, 36, 57, 218, 66, 176, 194, 0, 0, 254, 127, 100, 112, 173, 192, 213, 124, 41, 185, 0, 218, 202, 189, 0, 0, 254, 127, 156, 119, 174, 64, 91, 170, 36, 57, 218, 66, 176, 194, 0, 0, 254, 127, 156, 119, 174, 64, 213, 124, 41, 185, 0, 218, 202, 189, 0, 0, 254, 127)
}]

[sub_resource type="ConcavePolygonShape3D" id="12"]
data = PackedVector3Array(-5.42, 0.0002, -88.1306, 5.4521, -0.0002, -0.099, -5.42, -0.0002, -0.099, -5.42, 0.0002, -88.1306, 5.4521, 0.0002, -88.1306, 5.4521, -0.0002, -0.099)

[sub_resource type="ArrayMesh" id="13"]
resource_name = "NPBossCollision_Wall"
_surfaces = [{
"aabb": AABB(-5.41997, -0.000161636, -88.1306, 10.8721, 20.0003, 88.0315),
"format": 4099,
"index_count": 12,
"index_data": PackedByteArray(1, 0, 4, 0, 0, 0, 1, 0, 5, 0, 4, 0, 2, 0, 7, 0, 3, 0, 2, 0, 6, 0, 7, 0),
"primitive": 3,
"vertex_count": 8,
"vertex_data": PackedByteArray(100, 112, 173, 192, 91, 170, 36, 57, 218, 66, 176, 194, 255, 127, 0, 0, 100, 112, 173, 192, 213, 124, 41, 185, 0, 218, 202, 189, 255, 127, 0, 0, 156, 119, 174, 64, 91, 170, 36, 57, 218, 66, 176, 194, 1, 128, 0, 0, 156, 119, 174, 64, 213, 124, 41, 185, 0, 218, 202, 189, 1, 128, 0, 0, 100, 112, 173, 192, 82, 0, 160, 65, 218, 66, 176, 194, 255, 127, 0, 0, 100, 112, 173, 192, 171, 255, 159, 65, 0, 218, 202, 189, 255, 127, 0, 0, 156, 119, 174, 64, 82, 0, 160, 65, 218, 66, 176, 194, 1, 128, 0, 0, 156, 119, 174, 64, 171, 255, 159, 65, 0, 218, 202, 189, 1, 128, 0, 0)
}]

[sub_resource type="ConcavePolygonShape3D" id="14"]
data = PackedVector3Array(-5.42, -0.0002, -0.099, -5.42, 20.0002, -88.1306, -5.42, 0.0002, -88.1306, -5.42, -0.0002, -0.099, -5.42, 19.9998, -0.099, -5.42, 20.0002, -88.1306, 5.4521, 0.0002, -88.1306, 5.4521, 19.9998, -0.099, 5.4521, -0.0002, -0.099, 5.4521, 0.0002, -88.1306, 5.4521, 20.0002, -88.1306, 5.4521, 19.9998, -0.099)

[sub_resource type="StandardMaterial3D" id="1"]
vertex_color_use_as_albedo = true

[sub_resource type="ArrayMesh" id="2"]
resource_name = "NPBossReflection_ReflectionMesh"
_surfaces = [{
"aabb": AABB(-23.7989, 0.159912, 0.0298386, 49.4805, 87.984, 0.263612),
"attribute_data": PackedByteArray(8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255, 8, 8, 8, 255),
"format": 4107,
"index_count": 18,
"index_data": PackedByteArray(4, 0, 6, 0, 5, 0, 4, 0, 7, 0, 6, 0, 3, 0, 1, 0, 0, 0, 3, 0, 2, 0, 1, 0, 10, 0, 8, 0, 11, 0, 10, 0, 9, 0, 8, 0),
"material": SubResource("1"),
"primitive": 3,
"vertex_count": 12,
"vertex_data": PackedByteArray(25, 100, 190, 193, 180, 73, 176, 66, 202, 61, 150, 62, 0, 0, 0, 0, 25, 100, 190, 193, 1, 192, 35, 62, 234, 20, 150, 62, 0, 0, 0, 0, 100, 56, 185, 192, 1, 192, 35, 62, 234, 20, 150, 62, 0, 0, 0, 0, 100, 56, 185, 192, 180, 73, 176, 66, 202, 61, 150, 62, 0, 0, 0, 0, 100, 120, 173, 192, 180, 73, 176, 66, 16, 254, 246, 60, 0, 0, 0, 0, 100, 120, 173, 192, 0, 192, 35, 62, 0, 112, 244, 60, 0, 0, 0, 0, 156, 115, 174, 64, 0, 192, 35, 62, 0, 112, 244, 60, 0, 0, 0, 0, 156, 115, 174, 64, 180, 73, 176, 66, 16, 254, 246, 60, 0, 0, 0, 0, 156, 51, 186, 64, 180, 73, 176, 66, 202, 61, 150, 62, 0, 0, 0, 0, 156, 51, 186, 64, 1, 192, 35, 62, 234, 20, 150, 62, 0, 0, 0, 0, 231, 115, 205, 65, 1, 192, 35, 62, 234, 20, 150, 62, 0, 0, 0, 0, 231, 115, 205, 65, 180, 73, 176, 66, 202, 61, 150, 62, 0, 0, 0, 0)
}]

[sub_resource type="StandardMaterial3D" id="15"]
blend_mode = 1
specular_mode = 4
vertex_color_use_as_albedo = true
metallic = 1.0
metallic_specular = 1.0
roughness_texture = ExtResource("19")

[sub_resource type="StandardMaterial3D" id="3"]
vertex_color_use_as_albedo = true

[sub_resource type="ArrayMesh" id="4"]
resource_name = "NPBossReflection_ReflectionHighResMesh"
_surfaces = [{
"aabb": AABB(-6, -6, 0, 12, 12, 0.0301604),
"attribute_data": PackedByteArray(255, 59, 255, 59, 0, 0, 0, 0, 0, 0, 24, 192, 255, 59, 142, 6, 0, 0, 0, 0, 0, 0, 24, 64, 141, 6, 143, 6, 0, 0, 0, 0, 0, 0, 24, 64, 147, 6, 255, 59, 0, 0, 210, 54, 0, 0, 0, 0),
"format": 4127,
"index_count": 6,
"index_data": PackedByteArray(0, 0, 2, 0, 1, 0, 0, 0, 3, 0, 2, 0),
"material": SubResource("3"),
"primitive": 3,
"vertex_count": 4,
"vertex_data": PackedByteArray(0, 0, 192, 192, 2, 0, 192, 64, 16, 254, 246, 60, 0, 0, 0, 0, 15, 136, 15, 136, 0, 0, 192, 192, 0, 0, 192, 192, 0, 0, 0, 128, 0, 0, 0, 0, 15, 136, 15, 136, 0, 0, 192, 64, 0, 0, 192, 192, 0, 0, 0, 128, 0, 0, 0, 0, 15, 136, 15, 136, 0, 0, 192, 64, 2, 0, 192, 64, 16, 254, 246, 60, 0, 0, 0, 0, 15, 136, 15, 136)
}]

[node name="Stage" type="Node"]

[node name="Objects" type="Node3D" parent="."]
script = ExtResource("14")

[node name="CharacterSpawn" parent="Objects" instance=ExtResource("10")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -49)

[node name="Lockout" type="Node3D" parent="Objects/CharacterSpawn"]
script = ExtResource("18")
lockoutData = ExtResource("17")

[node name="SpawnTrigger" parent="Objects/CharacterSpawn" instance=ExtResource("11")]
isOneShot = true

[node name="Path3D" type="Node3D" parent="Objects/CharacterSpawn/SpawnTrigger"]
script = ExtResource("12")
path = NodePath("../../../../Paths/MainPath")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/CharacterSpawn/SpawnTrigger"]
shape = SubResource("9")

[node name="Checkpoint" type="Node3D" parent="Objects/CharacterSpawn/SpawnTrigger"]
script = ExtResource("13")

[node name="Erazor" parent="Objects" instance=ExtResource("9")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -70)

[node name="InfiniteHall" type="Node3D" parent="Objects"]
script = ExtResource("15")
hallRoot = NodePath("HallRoot")
sky = NodePath("../../Visuals/NPSky")
reflection = NodePath("Reflections")
itemBundle = NodePath("ItemBundle")
itemBundleLocations = [6, 18, 0]
collisionPiece = NodePath("Collision/Collision")
collisionPiece2 = NodePath("Collision/Collision2")

[node name="ItemBundle" parent="Objects/InfiniteHall" instance=ExtResource("16")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -58)

[node name="HallRoot" parent="Objects/InfiniteHall" instance=ExtResource("3")]

[node name="Hall2" parent="Objects/InfiniteHall/HallRoot" instance=ExtResource("3")]
transform = Transform3D(0.999848, 0, 0.0174526, 0, 1, 0, -0.0174524, 0, 0.999858, 0, 0, -87)

[node name="AdvanceTrigger" parent="Objects/InfiniteHall/HallRoot/Hall2" instance=ExtResource("11")]
transform = Transform3D(1, 0, -1.30385e-08, 0, 1, 0, 1.30385e-08, 0, 1, -0.628286, -1, -36.0057)

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/InfiniteHall/HallRoot/Hall2/AdvanceTrigger"]
transform = Transform3D(1, 0, -5.58794e-09, 0, 1, 0, 5.58794e-09, 0, 1, 0, 15, 0)
shape = SubResource("10")

[node name="Hall3" parent="Objects/InfiniteHall/HallRoot/Hall2" instance=ExtResource("3")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, 0, 0, -87)

[node name="Hall4" parent="Objects/InfiniteHall/HallRoot/Hall2/Hall3" instance=ExtResource("3")]
transform = Transform3D(0.999849, 0, 0.0174512, 0, 1, 0, -0.0174515, 0, 0.999829, -0.000183105, 0, -86.9957)

[node name="Hall5" parent="Objects/InfiniteHall/HallRoot/Hall2/Hall3/Hall4" instance=ExtResource("3")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, -4.76837e-06, 0, -87)

[node name="NPBossLOD" parent="Objects/InfiniteHall/HallRoot/Hall2/Hall3/Hall4/Hall5" instance=ExtResource("6")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, -1.51836, 0, -86.9868)

[node name="NPBossLOD" parent="Objects/InfiniteHall/HallRoot/Hall2/Hall3/Hall4/Hall5/NPBossLOD" instance=ExtResource("6")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, 0, 0, -87)

[node name="NPBossLOD" parent="Objects/InfiniteHall/HallRoot/Hall2/Hall3/Hall4/Hall5/NPBossLOD/NPBossLOD" instance=ExtResource("6")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, 0, 0, -87)

[node name="NPBossLOD" parent="Objects/InfiniteHall/HallRoot/Hall2/Hall3/Hall4/Hall5/NPBossLOD/NPBossLOD/NPBossLOD" instance=ExtResource("6")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, 0, 0, -87)

[node name="NPBossLOD2" parent="Objects/InfiniteHall/HallRoot/Hall2/Hall3/Hall4/Hall5/NPBossLOD/NPBossLOD/NPBossLOD/NPBossLOD" instance=ExtResource("6")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, 0, 0, -87)

[node name="Collision" type="Node3D" parent="Objects/InfiniteHall"]
visible = false

[node name="Collision" type="Node3D" parent="Objects/InfiniteHall/Collision"]

[node name="AdvanceTrigger" parent="Objects/InfiniteHall/Collision/Collision" instance=ExtResource("11")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, 0, -1, -97)

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/InfiniteHall/Collision/Collision/AdvanceTrigger"]
transform = Transform3D(1, 0, -5.58794e-09, 0, 1, 0, 5.58794e-09, 0, 1, 0, 15, 0)
shape = SubResource("10")

[node name="Floor" type="MeshInstance3D" parent="Objects/InfiniteHall/Collision/Collision"]
mesh = SubResource("11")
skeleton = NodePath("")

[node name="StaticBody3D" type="StaticBody3D" parent="Objects/InfiniteHall/Collision/Collision/Floor" groups=["floor"]]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/InfiniteHall/Collision/Collision/Floor/StaticBody3D"]
shape = SubResource("12")

[node name="Wall" type="MeshInstance3D" parent="Objects/InfiniteHall/Collision/Collision"]
mesh = SubResource("13")
skeleton = NodePath("")

[node name="StaticBody3D" type="StaticBody3D" parent="Objects/InfiniteHall/Collision/Collision/Wall" groups=["wall"]]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/InfiniteHall/Collision/Collision/Wall/StaticBody3D"]
shape = SubResource("14")

[node name="Collision2" type="Node3D" parent="Objects/InfiniteHall/Collision"]

[node name="AdvanceTrigger" parent="Objects/InfiniteHall/Collision/Collision2" instance=ExtResource("11")]
transform = Transform3D(0.999848, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999848, -1, -1, -194)

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/InfiniteHall/Collision/Collision2/AdvanceTrigger"]
transform = Transform3D(1, 0, -5.58794e-09, 0, 1, 0, 5.58794e-09, 0, 1, 0, 15, 0)
shape = SubResource("10")

[node name="Floor" type="MeshInstance3D" parent="Objects/InfiniteHall/Collision/Collision2"]
transform = Transform3D(0.999847, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999847, 0, 0, -87)
mesh = SubResource("11")
skeleton = NodePath("")

[node name="StaticBody3D" type="StaticBody3D" parent="Objects/InfiniteHall/Collision/Collision2/Floor" groups=["floor"]]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/InfiniteHall/Collision/Collision2/Floor/StaticBody3D"]
shape = SubResource("12")

[node name="Wall" type="MeshInstance3D" parent="Objects/InfiniteHall/Collision/Collision2"]
transform = Transform3D(0.999847, 0, 0.0174524, 0, 1, 0, -0.0174524, 0, 0.999847, 0, 0, -87)
mesh = SubResource("13")
skeleton = NodePath("")

[node name="StaticBody3D" type="StaticBody3D" parent="Objects/InfiniteHall/Collision/Collision2/Wall" groups=["wall"]]

[node name="CollisionShape3D" type="CollisionShape3D" parent="Objects/InfiniteHall/Collision/Collision2/Wall/StaticBody3D"]
shape = SubResource("14")

[node name="Reflections" type="Node3D" parent="Objects/InfiniteHall"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, 1, 0, -1, -4.37114e-08, 0, 0, 0)

[node name="Reflection" type="MeshInstance3D" parent="Objects/InfiniteHall/Reflections"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -9, 2.84217e-14)
material_override = ExtResource("8")
cast_shadow = 0
mesh = SubResource("2")
skeleton = NodePath("../..")
script = ExtResource("7")
environment = null
resolution = 512
fit_mode = 0
perturb_scale = 0.7
clip_bias = 0.1
position_offset = Vector2(0, 0)
render_sky = true
cull_mask = 1048575

[node name="Reflection2" type="MeshInstance3D" parent="Objects/InfiniteHall/Reflections"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 78.991, 0)
material_override = ExtResource("8")
cast_shadow = 0
mesh = SubResource("2")
skeleton = NodePath("../..")
script = ExtResource("7")
environment = null
resolution = 512
fit_mode = 0
perturb_scale = 0.7
clip_bias = 0.1
position_offset = Vector2(0, 0)
render_sky = true
cull_mask = 1048575

[node name="PlayerReflection" type="MeshInstance3D" parent="Objects/InfiniteHall/Reflections"]
material_override = SubResource("15")
cast_shadow = 0
mesh = SubResource("4")
skeleton = NodePath("../..")
script = ExtResource("7")
environment = null
resolution = 512
fit_mode = 0
perturb_scale = 0.7
clip_bias = 0.1
position_offset = Vector2(0, 0)
render_sky = true
cull_mask = 1048575

[node name="Visuals" type="Node3D" parent="."]

[node name="Moonlight" type="DirectionalLight3D" parent="Visuals"]
transform = Transform3D(2.563e-06, -0.642788, 0.766044, 0, 0.766044, 0.642788, -1, -1.64747e-06, 1.96337e-06, 12.4917, 0, -7.73828)
light_energy = 1.2
shadow_enabled = true
shadow_bias = 0.5
directional_shadow_blend_splits = true

[node name="NPSky" parent="Visuals" instance=ExtResource("2")]
transform = Transform3D(1.05654, 0, -2.26577, 0, 2.5, 0, 2.26577, 0, 1.05654, -4500, 0, -1000)

[node name="WorldEnvironment" type="WorldEnvironment" parent="Visuals"]
environment = ExtResource("4")

[node name="Paths" type="Node3D" parent="."]
visible = false

[node name="MainPath" type="Path3D" parent="Paths"]
curve = ExtResource("1")

[node name="BGM" parent="." instance=ExtResource("5")]
autoplay = true
bus = &"Master"

[connection signal="DuelCompleted" from="Objects/Erazor" to="Objects/InfiniteHall" method="ResetHallway"]
[connection signal="Activated" from="Objects/InfiniteHall/HallRoot/Hall2/AdvanceTrigger" to="Objects/InfiniteHall" method="AdvanceHall" flags=3]
[connection signal="Activated" from="Objects/InfiniteHall/Collision/Collision/AdvanceTrigger" to="Objects/InfiniteHall" method="AdvanceCollision" flags=3 binds= [true]]
[connection signal="Activated" from="Objects/InfiniteHall/Collision/Collision2/AdvanceTrigger" to="Objects/InfiniteHall" method="AdvanceCollision" flags=3 binds= [false]]
