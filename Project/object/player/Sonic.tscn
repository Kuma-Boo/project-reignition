[gd_scene load_steps=90 format=2]

[ext_resource path="res://object/player/resource/movement settings/RunSettings.tres" type="Resource" id=1]
[ext_resource path="res://object/player/resource/movement settings/BackstepSettings.tres" type="Resource" id=2]
[ext_resource path="res://object/player/resource/movement settings/RunningStrafeSettings.tres" type="Resource" id=3]
[ext_resource path="res://object/player/resource/movement settings/AirRunSettings.tres" type="Resource" id=4]
[ext_resource path="res://object/player/resource/movement settings/AirStrafeSettings.tres" type="Resource" id=5]
[ext_resource path="res://object/player/resource/movement settings/GrindStepLockout.tres" type="Resource" id=6]
[ext_resource path="res://object/player/resource/movement settings/BounceLockout.tres" type="Resource" id=7]
[ext_resource path="res://object/player/resource/movement settings/SidleSettings.tres" type="Resource" id=8]
[ext_resource path="res://object/player/resource/movement settings/GrindSettings.tres" type="Resource" id=9]
[ext_resource path="res://object/player/resource/script/CharacterController.cs" type="Script" id=10]
[ext_resource path="res://object/player/resource/script/CharacterAnimator.cs" type="Script" id=11]
[ext_resource path="res://object/player/resource/model/Model.tscn" type="PackedScene" id=12]
[ext_resource path="res://object/player/resource/script/CharacterSoulSkill.cs" type="Script" id=13]
[ext_resource path="res://object/player/resource/animation/BalanceStateMachine.tres" type="AnimationNodeStateMachinePlayback" id=14]
[ext_resource path="res://object/player/resource/script/CharacterSound.cs" type="Script" id=15]
[ext_resource path="res://sound/sfx/player/en/VOICE_E_2.wav" type="AudioStream" id=16]
[ext_resource path="res://sound/sfx/player/en/VOICE_E_24.wav" type="AudioStream" id=17]
[ext_resource path="res://sound/sfx/player/ja/VOICE_J_24.wav" type="AudioStream" id=18]
[ext_resource path="res://sound/sfx/player/ja/VOICE_J_2.wav" type="AudioStream" id=19]
[ext_resource path="res://sound/sfx/player/PLAYER_5.wav" type="AudioStream" id=20]
[ext_resource path="res://sound/sfx/player/PLAYER_75.wav" type="AudioStream" id=21]
[ext_resource path="res://object/player/resource/movement settings/StandingStrafeSettings.tres" type="Resource" id=22]
[ext_resource path="res://object/player/resource/script/CharacterPathFollower.cs" type="Script" id=23]
[ext_resource path="res://object/player/resource/script/CharacterLockon.cs" type="Script" id=24]

[sub_resource type="ConvexPolygonShape" id=130]
points = PoolVector3Array( 1, 0.5, 0, -1, 0.5, 0, -1, -20, 0, 1, -20, 0, 8, 0.5, 5, -8, 0.5, 5, -8, -20, 5, 8, -20, 5, 10, 0.5, 25, -10, 0.5, 25, -10, -20, 25, 10, -20, 25 )

[sub_resource type="SphereShape" id=129]
radius = 0.5

[sub_resource type="SphereShape" id=80]
radius = 0.3

[sub_resource type="AnimationNodeTransition" id=70]
input_count = 3
xfade_time = 0.16
input_0/name = "Normal"
input_0/auto_advance = false
input_1/name = "Balancing"
input_1/auto_advance = false
input_2/name = "Sidle"
input_2/auto_advance = false

[sub_resource type="AnimationNodeTransition" id=55]
input_count = 2
input_0/name = "Grounded"
input_0/auto_advance = false
input_1/name = "Airborne"
input_1/auto_advance = false

[sub_resource type="AnimationNodeTransition" id=111]
input_count = 2
xfade_time = 0.1
input_0/name = "Normal"
input_0/auto_advance = false
input_1/name = "Jumpdashing"
input_1/auto_advance = false

[sub_resource type="AnimationNodeTransition" id=103]
input_count = 2
xfade_time = 0.05
input_0/name = "Falling"
input_0/auto_advance = false
input_1/name = "Jumping"
input_1/auto_advance = false

[sub_resource type="AnimationNodeOneShot" id=125]

[sub_resource type="AnimationNodeAnimation" id=126]
animation = "backflip"

[sub_resource type="AnimationNodeAnimation" id=102]
animation = "fall-loop"

[sub_resource type="AnimationNodeAnimation" id=105]
animation = "fall-start"

[sub_resource type="AnimationNodeOneShot" id=104]
fadein_time = 0.0
fadeout_time = 0.02

[sub_resource type="AnimationNodeTimeSeek" id=123]

[sub_resource type="AnimationNodeAnimation" id=107]
animation = "jump-loop"

[sub_resource type="AnimationNodeAnimation" id=108]
animation = "jump-start"

[sub_resource type="AnimationNodeOneShot" id=106]
fadein_time = 0.0

[sub_resource type="AnimationNodeTimeScale" id=122]

[sub_resource type="AnimationNodeAnimation" id=120]
animation = "jump-accel-loop"

[sub_resource type="AnimationNodeAnimation" id=121]
animation = "jump-dash-loop"

[sub_resource type="AnimationNodeStateMachine" id=112]
states/jump-accel-loop/node = SubResource( 120 )
states/jump-accel-loop/position = Vector2( 257.464, 91.48 )
states/jump-dash-loop/node = SubResource( 121 )
states/jump-dash-loop/position = Vector2( 609.4, 91.8 )
start_node = "jump-accel-loop"

[sub_resource type="AnimationNodeBlendTree" id=109]
graph_offset = Vector2( -723.072, 36.1916 )
nodes/IsJumpDashing/node = SubResource( 111 )
nodes/IsJumpDashing/position = Vector2( -16, 144 )
nodes/IsJumping/node = SubResource( 103 )
nodes/IsJumping/position = Vector2( -912, 32 )
nodes/backflip/node = SubResource( 125 )
nodes/backflip/position = Vector2( -672, 112 )
nodes/backflip_anim/node = SubResource( 126 )
nodes/backflip_anim/position = Vector2( -912, 256 )
nodes/fall/node = SubResource( 104 )
nodes/fall/position = Vector2( -1360, -32 )
nodes/fall-loop/node = SubResource( 102 )
nodes/fall-loop/position = Vector2( -1584, -16 )
nodes/fall-start/node = SubResource( 105 )
nodes/fall-start/position = Vector2( -1984, 192 )
nodes/fall_reset/node = SubResource( 123 )
nodes/fall_reset/position = Vector2( -1520, 112 )
nodes/jump/node = SubResource( 106 )
nodes/jump/position = Vector2( -368, 160 )
nodes/jump-loop/node = SubResource( 107 )
nodes/jump-loop/position = Vector2( -1200, 176 )
nodes/jump-start/node = SubResource( 108 )
nodes/jump-start/position = Vector2( -592, 336 )
nodes/jump_cancel_time/node = SubResource( 122 )
nodes/jump_cancel_time/position = Vector2( -1808, 160 )
nodes/jump_dash_state/node = SubResource( 112 )
nodes/jump_dash_state/position = Vector2( -368, 400 )
node_connections = [ "IsJumping", 0, "fall", "IsJumping", 1, "jump-loop", "fall_reset", 0, "jump_cancel_time", "jump", 0, "backflip", "jump", 1, "jump-start", "fall", 0, "fall-loop", "fall", 1, "fall_reset", "backflip", 0, "IsJumping", "backflip", 1, "backflip_anim", "IsJumpDashing", 0, "jump", "IsJumpDashing", 1, "jump_dash_state", "jump_cancel_time", 0, "fall-start", "output", 0, "IsJumpDashing" ]

[sub_resource type="AnimationNodeAnimation" id=38]
animation = "balance-left-loop"

[sub_resource type="AnimationNodeAnimation" id=39]
animation = "balance-left-in-loop"

[sub_resource type="AnimationNodeAnimation" id=40]
animation = "balance-left-out-loop"

[sub_resource type="AnimationNodeBlendSpace1D" id=41]
blend_point_0/node = SubResource( 38 )
blend_point_0/pos = 0.0
blend_point_1/node = SubResource( 39 )
blend_point_1/pos = 1.0
blend_point_2/node = SubResource( 40 )
blend_point_2/pos = -1.0

[sub_resource type="AnimationNodeAnimation" id=42]
animation = "balance-right-out-loop"

[sub_resource type="AnimationNodeAnimation" id=43]
animation = "balance-right-loop"

[sub_resource type="AnimationNodeAnimation" id=44]
animation = "balance-right-in-loop"

[sub_resource type="AnimationNodeBlendSpace1D" id=45]
blend_point_0/node = SubResource( 42 )
blend_point_0/pos = 1.0
blend_point_1/node = SubResource( 43 )
blend_point_1/pos = 0.0
blend_point_2/node = SubResource( 44 )
blend_point_2/pos = -1.0

[sub_resource type="AnimationNodeAnimation" id=46]
animation = "shuffle-left"

[sub_resource type="AnimationNodeAnimation" id=47]
animation = "shuffle-right"

[sub_resource type="AnimationNodeStateMachineTransition" id=48]
switch_mode = 2
auto_advance = true

[sub_resource type="AnimationNodeStateMachineTransition" id=49]
switch_mode = 2
auto_advance = true

[sub_resource type="AnimationNodeStateMachineTransition" id=50]

[sub_resource type="AnimationNodeStateMachineTransition" id=51]

[sub_resource type="AnimationNodeStateMachine" id=52]
states/balance_left/node = SubResource( 41 )
states/balance_left/position = Vector2( 632.6, 98.6224 )
states/balance_right/node = SubResource( 45 )
states/balance_right/position = Vector2( 151, 98.328 )
states/shuffle-left/node = SubResource( 46 )
states/shuffle-left/position = Vector2( 388.293, 63.8 )
states/shuffle-right/node = SubResource( 47 )
states/shuffle-right/position = Vector2( 388.105, 160.6 )
transitions = [ "shuffle-left", "balance_left", SubResource( 48 ), "shuffle-right", "balance_right", SubResource( 49 ), "balance_right", "shuffle-left", SubResource( 50 ), "balance_left", "shuffle-right", SubResource( 51 ) ]
start_node = "shuffle-left"
graph_offset = Vector2( 88, 38 )

[sub_resource type="AnimationNodeOneShot" id=65]
fadein_time = 0.0
fadeout_time = 0.15

[sub_resource type="AnimationNodeAnimation" id=66]
animation = "countdown"

[sub_resource type="AnimationNodeAnimation" id=72]
animation = "RESET"

[sub_resource type="AnimationNodeTransition" id=114]
input_count = 2
xfade_time = 0.1
input_0/name = "Standing"
input_0/auto_advance = false
input_1/name = "Crouching"
input_1/auto_advance = false

[sub_resource type="AnimationNodeAnimation" id=88]
animation = "gait-loop"

[sub_resource type="AnimationNodeAnimation" id=89]
animation = "jog-loop"

[sub_resource type="AnimationNodeAnimation" id=90]
animation = "jog-left-loop"

[sub_resource type="AnimationNodeAnimation" id=91]
animation = "gait-left-loop"

[sub_resource type="AnimationNodeAnimation" id=92]
animation = "jog-right-loop"

[sub_resource type="AnimationNodeAnimation" id=93]
animation = "gait-right-loop"

[sub_resource type="AnimationNodeBlendSpace2D" id=94]
blend_point_0/node = SubResource( 88 )
blend_point_0/pos = Vector2( 0, 0 )
blend_point_1/node = SubResource( 89 )
blend_point_1/pos = Vector2( 0, 0.8 )
blend_point_2/node = SubResource( 90 )
blend_point_2/pos = Vector2( -1, 0.8 )
blend_point_3/node = SubResource( 91 )
blend_point_3/pos = Vector2( -1, 0 )
blend_point_4/node = SubResource( 92 )
blend_point_4/pos = Vector2( 1, 0.8 )
blend_point_5/node = SubResource( 93 )
blend_point_5/pos = Vector2( 1, 0 )
min_space = Vector2( -1, 0 )

[sub_resource type="AnimationNodeTimeScale" id=79]

[sub_resource type="AnimationNodeTransition" id=78]
input_count = 4
xfade_time = 0.2
input_0/name = "Backstep"
input_0/auto_advance = false
input_1/name = "Idle"
input_1/auto_advance = false
input_2/name = "Jogging"
input_2/auto_advance = false
input_3/name = "Running"
input_3/auto_advance = false

[sub_resource type="AnimationNodeTimeSeek" id=101]

[sub_resource type="AnimationNodeAnimation" id=85]
animation = "run-loop"

[sub_resource type="AnimationNodeAnimation" id=86]
animation = "run-left-loop"

[sub_resource type="AnimationNodeAnimation" id=87]
animation = "run-right-loop"

[sub_resource type="AnimationNodeBlendSpace1D" id=84]
blend_point_0/node = SubResource( 85 )
blend_point_0/pos = 0.0
blend_point_1/node = SubResource( 86 )
blend_point_1/pos = -1.0
blend_point_2/node = SubResource( 87 )
blend_point_2/pos = 1.0

[sub_resource type="AnimationNodeAnimation" id=124]
animation = "backstep-loop"

[sub_resource type="AnimationNodeAnimation" id=115]
animation = "crouch-loop"

[sub_resource type="AnimationNodeAnimation" id=116]
animation = "crouch-start"

[sub_resource type="AnimationNodeStateMachineTransition" id=117]
switch_mode = 2
auto_advance = true

[sub_resource type="AnimationNodeStateMachine" id=118]
states/crouch-loop/node = SubResource( 115 )
states/crouch-loop/position = Vector2( 539, 85.56 )
states/crouch-start/node = SubResource( 116 )
states/crouch-start/position = Vector2( 255.8, 85.688 )
transitions = [ "crouch-start", "crouch-loop", SubResource( 117 ) ]
start_node = "crouch-start"

[sub_resource type="AnimationNodeBlendTree" id=71]
graph_offset = Vector2( -742.031, 133.664 )
nodes/Idle/node = SubResource( 72 )
nodes/Idle/position = Vector2( -1200, 240 )
nodes/IsCrouching/node = SubResource( 114 )
nodes/IsCrouching/position = Vector2( 96, 160 )
nodes/Jog/node = SubResource( 94 )
nodes/Jog/position = Vector2( -944, 400 )
nodes/MoveSpeed/node = SubResource( 79 )
nodes/MoveSpeed/position = Vector2( -480, 192 )
nodes/MoveState/node = SubResource( 78 )
nodes/MoveState/position = Vector2( -656, 256 )
nodes/MovementReset/node = SubResource( 101 )
nodes/MovementReset/position = Vector2( -304, 176 )
nodes/Run/node = SubResource( 84 )
nodes/Run/position = Vector2( -944, 592 )
nodes/backstep/node = SubResource( 124 )
nodes/backstep/position = Vector2( -944, 128 )
nodes/crouch_state/node = SubResource( 118 )
nodes/crouch_state/position = Vector2( -144, 336 )
node_connections = [ "MoveSpeed", 0, "MoveState", "IsCrouching", 0, "MovementReset", "IsCrouching", 1, "crouch_state", "MoveState", 0, "backstep", "MoveState", 1, "Idle", "MoveState", 2, "Jog", "MoveState", 3, "Run", "MovementReset", 0, "MoveSpeed", "output", 0, "IsCrouching" ]

[sub_resource type="AnimationNodeAnimation" id=127]
animation = "sidle-fast-loop"

[sub_resource type="AnimationNodeTimeScale" id=128]

[sub_resource type="AnimationNodeBlendTree" id=37]
graph_offset = Vector2( -717.179, 86.4969 )
nodes/ActionState/node = SubResource( 70 )
nodes/ActionState/position = Vector2( -464, 176 )
nodes/IsGrounded/node = SubResource( 55 )
nodes/IsGrounded/position = Vector2( -960, 192 )
nodes/air_state/node = SubResource( 109 )
nodes/air_state/position = Vector2( -1280, 288 )
nodes/balance_state/node = SubResource( 52 )
nodes/balance_state/position = Vector2( -720, 272 )
nodes/countdown/node = SubResource( 65 )
nodes/countdown/position = Vector2( 112, 160 )
nodes/countdown_anim/node = SubResource( 66 )
nodes/countdown_anim/position = Vector2( -144, 288 )
nodes/ground_state/node = SubResource( 71 )
nodes/ground_state/position = Vector2( -1280, 160 )
nodes/sidle_anim/node = SubResource( 127 )
nodes/sidle_anim/position = Vector2( -880, 464 )
nodes/sidle_speed/node = SubResource( 128 )
nodes/sidle_speed/position = Vector2( -672, 432 )
node_connections = [ "ActionState", 0, "IsGrounded", "ActionState", 1, "balance_state", "ActionState", 2, "sidle_speed", "countdown", 0, "ActionState", "countdown", 1, "countdown_anim", "sidle_speed", 0, "sidle_anim", "IsGrounded", 0, "ground_state", "IsGrounded", 1, "air_state", "output", 0, "countdown" ]

[sub_resource type="AnimationNodeStateMachinePlayback" id=113]

[sub_resource type="AnimationNodeStateMachinePlayback" id=119]

[node name="Player" type="KinematicBody" groups=["player"]]
collision_layer = 8
script = ExtResource( 10 )
pathFollower = NodePath("Components/PathFollower")
animator = NodePath("Components/Model")
sound = NodePath("Components/Sound")
soul = NodePath("Components/SoulSkills")
lockon = NodePath("Components/Model/LockonTrigger")
moveSettings = ExtResource( 1 )
airMoveSettings = ExtResource( 4 )
runningStrafeSettings = ExtResource( 3 )
standingStrafeSettings = ExtResource( 22 )
airStrafeSettings = ExtResource( 5 )
backstepSettings = ExtResource( 2 )
maxGravity = -48.0
landingBoost = 18.0
accelerationJumpSpeed = 28.0
jumpHeight = 3.8
jumpDashSpeed = 24.0
jumpDashPower = 4.0
jumpDashGravity = 18.0
jumpDashMaxGravity = -24.0
backflipSpeed = 20.0
backflipHeight = 1.4
sidleSettings = ExtResource( 8 )
grindingSettings = ExtResource( 9 )
grindStepLockoutSettings = ExtResource( 6 )
grindShuffleSpeed = 28
grindStepSpeed = 15
grindStepHeight = 12
environmentCollider = NodePath("CollisionShape")
environmentMask = 1

[node name="Components" type="Spatial" parent="."]

[node name="PathFollower" type="PathFollow" parent="Components"]
rotation_mode = 4
loop = false
script = ExtResource( 23 )
character = NodePath("../..")

[node name="Model" parent="Components" instance=ExtResource( 12 )]
script = ExtResource( 11 )
animator = NodePath("../../AnimationTree")
root = NodePath("../..")

[node name="Body" parent="Components/Model/Sonic/Skeleton" index="0"]
portal_mode = 4
use_in_baked_light = true

[node name="EyeL" parent="Components/Model/Sonic/Skeleton" index="1"]
portal_mode = 4
use_in_baked_light = true

[node name="EyeR" parent="Components/Model/Sonic/Skeleton" index="2"]
portal_mode = 4
use_in_baked_light = true

[node name="Metal" parent="Components/Model/Sonic/Skeleton" index="3"]
portal_mode = 4
use_in_baked_light = true

[node name="VFX" type="Spatial" parent="Components/Model"]

[node name="LockonTrigger" type="Area" parent="Components/Model"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0 )
collision_layer = 0
collision_mask = 4
monitorable = false
script = ExtResource( 24 )
homingAttackSpeed = 48.0
bounceLockoutSettings = ExtResource( 7 )
bounceSpeed = -8.0
bouncePower = 14.0

[node name="Collision" type="CollisionShape" parent="Components/Model/LockonTrigger"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.3 )
shape = SubResource( 130 )

[node name="Sound" type="Node" parent="Components"]
script = ExtResource( 15 )
enClips = [ ExtResource( 16 ), ExtResource( 17 ) ]
jaClips = [ ExtResource( 19 ), ExtResource( 18 ) ]
actionClips = [ ExtResource( 20 ), ExtResource( 21 ) ]
voiceChannel = NodePath("VoiceChannel")
sfxChannels = [ NodePath("ActionChannel"), NodePath("FootstepChannel"), NodePath("FootstepChannel2") ]

[node name="VoiceChannel" type="AudioStreamPlayer" parent="Components/Sound"]
stream = ExtResource( 16 )
bus = "VOICE"

[node name="ActionChannel" type="AudioStreamPlayer" parent="Components/Sound"]
bus = "SFX"

[node name="FootstepChannel" type="AudioStreamPlayer" parent="Components/Sound"]
bus = "SFX"

[node name="FootstepChannel2" type="AudioStreamPlayer" parent="Components/Sound"]
bus = "SFX"

[node name="SoulSkills" type="Node" parent="Components"]
script = ExtResource( 13 )
isSpeedBreakEnabled = true
isTimeBreakEnabled = true

[node name="ObjectTrigger" type="Area" parent="Components" groups=["player"]]
transform = Transform( 1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0.42, 0 )
collision_layer = 2

[node name="Trigger" type="CollisionShape" parent="Components/ObjectTrigger"]
shape = SubResource( 129 )

[node name="CollisionShape" type="CollisionShape" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0 )
shape = SubResource( 80 )

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource( 37 )
anim_player = NodePath("../Components/Model/AnimationPlayer")
active = true
parameters/ActionState/current = 0
parameters/IsGrounded/current = 0
parameters/air_state/IsJumpDashing/current = 0
parameters/air_state/IsJumping/current = 0
parameters/air_state/backflip/active = false
parameters/air_state/fall/active = false
parameters/air_state/fall_reset/seek_position = -1.0
parameters/air_state/jump/active = false
parameters/air_state/jump_cancel_time/scale = 1.0
parameters/air_state/jump_dash_state/playback = SubResource( 113 )
parameters/balance_state/playback = ExtResource( 14 )
parameters/balance_state/balance_left/blend_position = -0.00141644
parameters/balance_state/balance_right/blend_position = -0.00914633
parameters/countdown/active = false
parameters/ground_state/IsCrouching/current = 0
parameters/ground_state/Jog/blend_position = Vector2( 0, 0 )
parameters/ground_state/MoveSpeed/scale = 1.0
parameters/ground_state/MoveState/current = 1
parameters/ground_state/MovementReset/seek_position = -1.0
parameters/ground_state/Run/blend_position = 0.0
parameters/ground_state/crouch_state/playback = SubResource( 119 )
parameters/sidle_speed/scale = 1.5

[connection signal="area_entered" from="Components/Model/LockonTrigger" to="Components/Model/LockonTrigger" method="OnTargetTriggerEnter"]
[connection signal="area_exited" from="Components/Model/LockonTrigger" to="Components/Model/LockonTrigger" method="OnTargetTriggerExit"]
[connection signal="body_entered" from="Components/Model/LockonTrigger" to="Components/Model/LockonTrigger" method="OnTargetBodyEnter"]
[connection signal="body_exited" from="Components/Model/LockonTrigger" to="Components/Model/LockonTrigger" method="OnTargetBodyExit"]
[connection signal="body_entered" from="Components/ObjectTrigger" to="." method="OnObjectCollisionEnter"]
[connection signal="body_exited" from="Components/ObjectTrigger" to="." method="OnObjectCollisionExit"]

[editable path="Components/Model"]
