[gd_scene load_steps=46 format=3 uid="uid://ddig36ceo6kee"]

[ext_resource type="PackedScene" uid="uid://ol3cwm16sc23" path="res://object/player/resource/model/Sonic.gltf" id="3_1wesb"]
[ext_resource type="Script" path="res://object/player/resource/script/CharacterPathFollower.cs" id="6_80hf8"]
[ext_resource type="PackedScene" path="res://object/player/resource/component/lockon/Lockon.tscn" id="7"]
[ext_resource type="PackedScene" uid="uid://cyd2ep1n5php3" path="res://object/player/resource/component/Sound.tscn" id="8_ni1dd"]
[ext_resource type="Script" path="res://object/player/resource/script/CharacterController.cs" id="10"]
[ext_resource type="Script" path="res://object/player/resource/script/CharacterAnimator.cs" id="11"]
[ext_resource type="PackedScene" uid="uid://dqb313n3ldim8" path="res://object/player/resource/component/Skills.tscn" id="13"]

[sub_resource type="Curve" id="Curve_0y4at"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.3, 0), 0.0, 0.0, 0, 0, Vector2(0.55, 1), 0.0777784, 0.0, 0, 0, Vector2(1, 1), 0.0, 0.0, 0, 0]
point_count = 4

[sub_resource type="SphereMesh" id="SphereMesh_f0gyp"]

[sub_resource type="BoxMesh" id="BoxMesh_t4t3r"]
size = Vector3(0.5, 0.1, 1)

[sub_resource type="Curve" id="Curve_skwgn"]
min_value = 1.0
max_value = 2.0
_data = [Vector2(0, 1.2), 0.0, 0.0, 0, 0, Vector2(0.45, 1.475), 1.5, 1.5, 0, 0, Vector2(0.8, 2), 0.0, 0.0, 0, 0, Vector2(1, 1.2), -12.0, 0.0, 0, 0]
point_count = 4

[sub_resource type="SphereShape3D" id="SphereShape3D_uookt"]

[sub_resource type="SphereShape3D" id="80"]
radius = 0.36

[sub_resource type="AnimationNodeOneShot" id="65"]
fadeout_time = 0.15

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_m3yux"]
animation = &"backflip"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_kh4no"]
animation = &"fall-loop"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_ndh67"]
animation = &"fall"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_xjskw"]
animation = &"backstep"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_vrk66"]
animation = &"idle"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_3th54"]
animation = &"walk"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_rmoy0"]
animation = &"jog"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_edwoh"]
blend_point_0/node = SubResource("AnimationNodeAnimation_3th54")
blend_point_0/pos = 0.0
blend_point_1/node = SubResource("AnimationNodeAnimation_rmoy0")
blend_point_1/pos = 0.3
min_space = 0.0
sync = true

[sub_resource type="AnimationNodeTimeScale" id="AnimationNodeTimeScale_ca6kw"]

[sub_resource type="Curve" id="Curve_vaymi"]
_data = [Vector2(0, 0), 0.0, 0.0, 0, 0, Vector2(0.55668, 0.249097), 1.08554, 1.08554, 0, 0, Vector2(1, 1), 0.0, 0.0, 0, 0]
point_count = 3

[sub_resource type="AnimationNodeTransition" id="AnimationNodeTransition_vdtx5"]
sync = true
enabled_inputs = 4
xfade_time = 0.4
xfade_curve = SubResource("Curve_vaymi")
input_0/name = "idle"
input_0/auto_advance = false
input_1/name = "backstep"
input_1/auto_advance = false
input_2/name = "jog"
input_2/auto_advance = false
input_3/name = "run"
input_3/auto_advance = false

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_tl3sm"]
animation = &"run"

[sub_resource type="AnimationNodeBlendSpace1D" id="AnimationNodeBlendSpace1D_4a20h"]
blend_point_0/node = SubResource("AnimationNodeAnimation_tl3sm")
blend_point_0/pos = 0.0
sync = true

[sub_resource type="AnimationNodeBlendTree" id="AnimationNodeBlendTree_vw7yp"]
graph_offset = Vector2(-594.819, 9.25688)
nodes/backstep_anim/node = SubResource("AnimationNodeAnimation_xjskw")
nodes/backstep_anim/position = Vector2(-464, 128)
nodes/idle_anim/node = SubResource("AnimationNodeAnimation_vrk66")
nodes/idle_anim/position = Vector2(-464, -16)
nodes/jog_blend/node = SubResource("AnimationNodeBlendSpace1D_edwoh")
nodes/jog_blend/position = Vector2(-464, 240)
nodes/move_speed/node = SubResource("AnimationNodeTimeScale_ca6kw")
nodes/move_speed/position = Vector2(80, 128)
nodes/move_transition/node = SubResource("AnimationNodeTransition_vdtx5")
nodes/move_transition/position = Vector2(-176, 96)
nodes/run_blend/node = SubResource("AnimationNodeBlendSpace1D_4a20h")
nodes/run_blend/position = Vector2(-464, 368)
node_connections = [&"output", 0, &"move_speed", &"move_speed", 0, &"move_transition", &"move_transition", 0, &"idle_anim", &"move_transition", 1, &"backstep_anim", &"move_transition", 2, &"jog_blend", &"move_transition", 3, &"run_blend"]

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_o72mp"]
animation = &"jump-loop"

[sub_resource type="AnimationNodeAnimation" id="AnimationNodeAnimation_qm7rg"]
animation = &"jump"

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_kmre7"]
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_dyroj"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_gsw68"]

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_itkwq"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachineTransition" id="AnimationNodeStateMachineTransition_ri2be"]
switch_mode = 2
advance_mode = 2

[sub_resource type="AnimationNodeStateMachine" id="AnimationNodeStateMachine_3p6g0"]
states/End/position = Vector2(806.4, 82.88)
states/Start/position = Vector2(130.4, 83.2)
states/backflip/node = SubResource("AnimationNodeAnimation_m3yux")
states/backflip/position = Vector2(440.271, 283.007)
states/fall/node = SubResource("AnimationNodeAnimation_ndh67")
states/fall/position = Vector2(329.984, 167.754)
states/fall-loop/node = SubResource("AnimationNodeAnimation_kh4no")
states/fall-loop/position = Vector2(440.384, 168.244)
states/ground_tree/node = SubResource("AnimationNodeBlendTree_vw7yp")
states/ground_tree/position = Vector2(440.48, 83.6166)
states/jump/node = SubResource("AnimationNodeAnimation_qm7rg")
states/jump/position = Vector2(43.7441, 167.375)
states/jump-loop/node = SubResource("AnimationNodeAnimation_o72mp")
states/jump-loop/position = Vector2(199.744, 166.575)
transitions = ["Start", "ground_tree", SubResource("AnimationNodeStateMachineTransition_kmre7"), "jump", "jump-loop", SubResource("AnimationNodeStateMachineTransition_dyroj"), "jump-loop", "fall", SubResource("AnimationNodeStateMachineTransition_gsw68"), "fall", "fall-loop", SubResource("AnimationNodeStateMachineTransition_itkwq"), "backflip", "fall-loop", SubResource("AnimationNodeStateMachineTransition_ri2be")]
graph_offset = Vector2(27, 146)

[sub_resource type="AnimationNodeAnimation" id="131"]
animation = &"RESET"

[sub_resource type="AnimationNodeTransition" id="130"]
enabled_inputs = 4
input_0/name = "countdown"
input_0/auto_advance = false
input_1/name = "state 1"
input_1/auto_advance = false
input_2/name = "state 2"
input_2/auto_advance = false
input_3/name = "state 3"
input_3/auto_advance = false

[sub_resource type="AnimationNodeBlendTree" id="132"]
graph_offset = Vector2(-398.791, 76.4977)
nodes/countdown/node = SubResource("131")
nodes/countdown/position = Vector2(-320, 160)
nodes/oneshot_transition/node = SubResource("130")
nodes/oneshot_transition/position = Vector2(-16, 144)
node_connections = [&"output", 0, &"oneshot_transition", &"oneshot_transition", 0, &"countdown"]

[sub_resource type="AnimationNodeTransition" id="70"]
enabled_inputs = 2
input_0/name = "normal"
input_0/auto_advance = false
input_1/name = "grinding"
input_1/auto_advance = false

[sub_resource type="AnimationNodeBlendTree" id="37"]
graph_offset = Vector2(-849.283, 86.6866)
nodes/countdown_trigger/node = SubResource("65")
nodes/countdown_trigger/position = Vector2(48, 160)
nodes/normal_state/node = SubResource("AnimationNodeStateMachine_3p6g0")
nodes/normal_state/position = Vector2(-656, 192)
nodes/oneshot_tree/node = SubResource("132")
nodes/oneshot_tree/position = Vector2(-176, 272)
nodes/state_transition/node = SubResource("70")
nodes/state_transition/position = Vector2(-416, 176)
node_connections = [&"output", 0, &"countdown_trigger", &"countdown_trigger", 0, &"state_transition", &"countdown_trigger", 1, &"oneshot_tree", &"state_transition", 0, &"normal_state"]

[sub_resource type="AnimationNodeStateMachinePlayback" id="AnimationNodeStateMachinePlayback_5h3hv"]

[sub_resource type="Animation" id="Animation_dbqye"]
length = 0.001

[sub_resource type="Animation" id="Animation_v1whi"]
resource_name = "invincibility"
length = 3.0
step = 0.0333333

[sub_resource type="AnimationLibrary" id="AnimationLibrary_3ughb"]
_data = {
"RESET": SubResource("Animation_dbqye"),
"invincibility": SubResource("Animation_v1whi")
}

[node name="Player" type="CharacterBody3D" node_paths=PackedStringArray("environmentCollider", "PathFollower", "Animator", "Sound", "Skills", "Lockon") groups=["player"]]
collision_layer = 2
collision_mask = 9
floor_stop_on_slope = false
floor_constant_speed = true
safe_margin = 0.01
script = ExtResource("10")
turningSpeedCurve = SubResource("Curve_0y4at")
landingBoost = 32.0
jumpHeight = 4.8
jumpDashSpeed = 36.0
jumpDashPower = 4.0
jumpDashGravity = 18.0
jumpDashMaxGravity = -24.0
backflipHeight = 2.4
environmentCollider = NodePath("CollisionShape3D")
PathFollower = NodePath("Components/PathFollower")
Animator = NodePath("Components/Sonic")
Sound = NodePath("Components/Sound")
Skills = NodePath("Components/Skills")
Lockon = NodePath("Components/Lockon")

[node name="Components" type="Node3D" parent="."]

[node name="PathFollower" type="PathFollow3D" parent="Components"]
visible = false
loop = false
script = ExtResource("6_80hf8")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Components/PathFollower"]
mesh = SubResource("SphereMesh_f0gyp")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Components/PathFollower/MeshInstance3D"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.4)
mesh = SubResource("BoxMesh_t4t3r")

[node name="Sonic" parent="Components" node_paths=PackedStringArray("animator") instance=ExtResource("3_1wesb")]
script = ExtResource("11")
animator = NodePath("../../AnimationTree")
movementAnimationSpeedCurve = SubResource("Curve_skwgn")

[node name="VFX" type="Node3D" parent="Components/Sonic"]

[node name="Skills" parent="Components" instance=ExtResource("13")]

[node name="Sound" parent="Components" instance=ExtResource("8_ni1dd")]

[node name="Lockon" parent="Components" instance=ExtResource("7")]

[node name="ObjectTrigger" type="Area3D" parent="Components" groups=["player"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.5, 0)
collision_layer = 2
collision_mask = 9

[node name="Trigger" type="CollisionShape3D" parent="Components/ObjectTrigger"]
shape = SubResource("SphereShape3D_uookt")

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.36, 0)
shape = SubResource("80")

[node name="AnimationTree" type="AnimationTree" parent="."]
tree_root = SubResource("37")
anim_player = NodePath("../Components/Sonic/AnimationPlayer")
parameters/countdown_trigger/active = false
parameters/normal_state/playback = SubResource("AnimationNodeStateMachinePlayback_5h3hv")
parameters/normal_state/ground_tree/jog_blend/blend_position = 0
parameters/normal_state/ground_tree/move_speed/scale = 1.0
parameters/normal_state/ground_tree/move_transition/current = 0
parameters/normal_state/ground_tree/run_blend/blend_position = 0
parameters/oneshot_tree/oneshot_transition/current = 0
parameters/state_transition/current = 0

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
"": SubResource("AnimationLibrary_3ughb")
}

[connection signal="body_entered" from="Components/ObjectTrigger" to="." method="OnObjectCollisionEnter"]
[connection signal="body_exited" from="Components/ObjectTrigger" to="." method="OnObjectCollisionExit"]
